<script language="javascript">
    function confirmDialog(title, id_course, id_date) {
        closeAllDatesPopup(id_course);
        $('<div></div>').appendTo('body')
            .html("<div><h6>{{ translate('_SELF_UNSUBSCRIBE', 'course') }}</h6></div>")
            .dialog({
                modal: true,
                title: title,
                autoOpen: true,
                width: '200',
                height: '150',
                resizable: false,
                buttons: {
                    {{ translate('_CONFIRM', 'standard') }}:

                        function() {
                            var posting = $.get(
                                'ajax.server.php', {
                                    r: 'elearning/self_unsubscribe',
                                    id_course: id_course,
                                    id_date: id_date
                                }
                            );
                            posting.done(function(responseText) {
                                var ft = $("#course_search_filter_text").val();
                                var ctype = $("#course_search_filter_type").selectpicker().val();
                                var category = $('#course_search_filter_cat').selectpicker().val();
                                var cyear = $("#course_search_filter_year").selectpicker().val();
                                var json_status = $('.js-label-menu-filter.selected').attr('data-value');
                                $("#div_course").html("<br><p align='center'><img src='{{ evalPhp('Layout::path') }}images/standard/loadbar.gif'></p>");
                               var posting = $.get('ajax.server.php?r=elearning/all&rnd={{ date().timestamp }}&filter_text=' + ft + '&filter_type=' + ctype + '&filter_cat=' + category + '&filter_status=' + json_status + '&filter_year=' + cyear, {});
                                posting.done(function(responseText) {
                                    $("#div_course").html(responseText);
                                });
                            });
                            posting.fail(function() {
                                alert('unsubscribe failed')
                            })
                            $(this).dialog("close");
                        }

                        ,
                    {{ translate('_UNDO', 'standard') }}:

                        function() {
                            $(this).dialog("close");
                        }
                },
                open: function(event, ui) {
                    $(".ui-dialog-titlebar-close", ui.dialog | ui).hide();
                },
                close: function(event, ui) {
                    $(this).remove();
                }
            });
    }


    function openAllDatesPopup($id) {
        $('*[data-overlay="course-' + $id + '"]').fadeIn();
    }

    function closeAllDatesPopup($id) {
        $('*[data-overlay="course-' + $id + '"]').fadeOut();
    }
</script>


<link rel="shortcut icon" href="../favicon.ico">


<div id='container'>
    <h1 class="page-header col-xs-12"><strong> {{filter_type}} </strong></h1>
    <div class="clearfix row" id='mia_area_{{stato_corso}}'>
        {% if courselist is empty %}
            <div class="col-xs-12">
        {% block emptycourselist %} <p>{{ translate('_NO_CONTENT', 'standard') }}</p> {% endblock %}
            </div>    
       {% endif %}
     
        {% for course in courselist %}    
        {% set courseBoxClasses = [] %}
        {% if not course.can_enter.can %}
            {% set courseBoxClasses = courseBoxClasses|merge(['course-box--disabled']) %}
        {% endif %}

            <div class="col-xs-12 col-md-4 col-lg-3 mycourses-list">

                <article class="course-box {{ courseBoxClasses|join(' ') }}">



                    {% block courseimage %} 
                        <div class="course-box__cover" {% if course.use_logo_in_courselist %} style="background-image: url( {{ course.img_course }})"{% endif %}></div>
                    {% endblock %}



                    <header class="course-box__header">
                        {% block icon %} 
                            <div class="course-box__icon icon--filter-{{ course.user_status }}"></div>
                        {% endblock %}



                        {% block role %}  
                            <div class="course-box__icon course-box__owner--{{ course.level_icon }}" aria-label="{{ course.level_text }}"></div> 
                        {% endblock %}
                    </header>



                    {% block category %} 
                        {% if (course.nameCategory) %}
                            <div class="course-box__category">
                                {{ course.nameCategory }}
                            </div>
                        {% endif %}
                    {% endblock %}



                    {% if (course.userCanUnsubscribe or course.course_demo ) and course.course_type == 'elearning' %} 
                        <nav class="course-box__nav">
                            <div class="course-box__options dropdown pull-right">
                                <div class="dropdown-toggle" id="courseBoxOptions" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                    <i class="glyphicon glyphicon-option-horizontal"></i>
                                </div>
                                        
                                <ul class="dropdown-menu" aria-labelledby="courseBoxOptions">
                                    {% if course.userCanUnsubscribe %}  
                                        {% block unsubscribe %}
                                        <li>
                                            <a href="javascript:confirmDialog('{{ course.name }}', {{ course.idCourse }})">{{ translate('_SELF_UNSUBSCRIBE', 'course') }}</a>
                                        </li>
                                        {% endblock %} 
                                    {% endif %}
                                                
                                    {% if course.course_demo %}  
                                        {% block demo %}
                                        <li>
                                            <a href="index.php?r=catalog/downloadDemoMaterial&amp;course_id={{ course.idCourse }}"> {{ translate('_COURSE_DEMO', 'course') }}</a>
                                        </li>
                                        {% endblock %} 
                                    {% endif %}
                                </ul>
                            </div>
                        </nav>
                    {% endif %}


                                        
                    {% block title %} 
                        <h3 class="course-box__title">{{ course.name }}</h3>
                        {# <h3 class="course-box__title {{ course.tooltipClass }}">{{ course.name }}</h3>
                        <span class="twig-course-tooltipElement_raw">{{ course.tooltipElement|raw }}</span> #}
                    {% endblock %}



                    {% block coursedescription %} 
                        <div class="course-box__description"> {{ course.box_description }} </div>
                    {% endblock %}






                    {# <div class="course-box__item course-box__item{% if course.dateClosing_year > 0 %}--half{% endif %}"> #}
                    <div class="course-box__cta">





                        {% block closingdate %}
                            {% if course.dateClosing_year > 0 %}
                            <div class="course-box__closingdate">
                                <span class="course-box__closingdate__text">{{ translate('_CLOSING_DATE', 'course') }}</span>
                                <span class="course-box__closingdate__value">{{ course.dateClosing_day}} {{ course.dateClosing_month }} {{ course.dateClosing_year }}</span>
                            </div>
                            {% endif %}
                        {% endblock %}






                        {% if (course.course_type == 'classroom' and course.editions|length) > 0 %}
                        <div class="course-box__extrainformation">
                            <div class="course-box__next">
                            {% block nextlesson %} 
                                <span class="course-box__next__text">{{ translate('_NEXT_LESSON', 'course') }}</span>
                                <span class="course-box__next__value">{{ course.next_lesson }}</span>
                            {% endblock %}
                            </div>
                            <div class="course-box__allDates">
                                <a href="javascript:;" onclick="openAllDatesPopup({{ course.idCourse }})">{{ translate('_SHOW_ALL_DATES', 'course') }}</a>
                                <div class="show-all-dates-popup" data-overlay="course-{{ course.idCourse }}">
                                    <div id="pop_up_container" class="yui-module yui-overlay yui-panel">
                                        <a class="container-close" href="javascript:;" onclick="closeAllDatesPopup({{ course.idCourse }})"></a>
                                        <div class="hd" id="pop_up_container_h">{{ course.name }}</div>
                                        <div class="bd">
                                            <div class="edition_container">
                                                <table class="edition_table">
                                                    <thead>
                                                        <tr>
                                                            <th>{{ translate('_DAY', 'course') }}</th>
                                                            <th>{{ translate('_HOUR_BEGIN', 'course') }}</th>
                                                            <th>{{ translate('_HOUR_END', 'course') }}</th>
                                                            <th>{{ translate('_LOCATION_INFO', 'classroom') }}</th>  
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% for id_edition, days in course.editions %} 
                                                            <tr><td colspan=4>{{ translate('_EDITION') }}:&nbsp; {{ days.name }}<td></tr> 
                                                            {% if course.userCanUnsubscribe %}    
                                                                <tr><td colspan=4><a href="javascript:confirmDialog('{{ course.name }}','{{ course.idCourse }}','{{ id_edition }}')">{{ translate('_SELF_UNSUBSCRIBE', 'course') }}</a><td></tr>
                                                            {% endif %}  
                                                            {% for day in days.days%}  
                                                                    <tr> 
                                                                        {% if day.day in course.next_lesson %}
                                                                        
                                                                        <td><b>{{ day.day}}</b></td> 
                                                                        <td><b>{{ day.begin}}</b></td>
                                                                        <td><b>{{ day.end}}</b></td>
                                                                        <td><b>{{ day.classroom}}</b></td>
                                                                        
                                                                        {% else %} 
                                                                            
                                                                        <td>{{ day.day}}</td> 
                                                                        <td>{{ day.begin}}</td>
                                                                        <td>{{ day.end}}</td>
                                                                        <td>{{ day.classroom}}</td>
                                                                        {% endif %}   
                                                                    </tr>
                                                            {% endfor %}  
                                                        {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}
    



                        {% if course.can_enter.can %}                                                      
                            {% block entercourse %}
                            <a class="forma-button course-box__cta__button" title="{{ course.name }}" href="index.php?modname=course&amp;op=aula&amp;idCourse={{ course.idCourse }} " rel= {{ course.rel }}>
                                <span class="forma-button__label"> {{ translate('_USER_STATUS_ENTER', 'catalogue') }}</span>
                            </a>   
                            {% endblock %}
                        {% else %}
                            {% block enterdisabled %}  
                            <a class="forma-button forma-button--disabled" href="javascript:void(0);">
                                <span class="forma-button__label">
                                    {{ translate('_DISABLED', 'course') }}
                                </span>
                            </a>       
                            {% endblock %}
                        {% endif %}
                    </div>


                    </div>
                </article>
       {% endfor%}
            </div>
    </div>
</div>