{{ Get_title({
    'index.php?r=adm/lang/show' : translate('_LANGUAGE', 'admin_lang'),
    '':translate('_TRANSLATELANG', 'admin_lang')
},false) }}


<div class="std_blockx">
    <div class="container-back">
        <a href="index.php?r=adm/lang/show"><span>{{ translate('_BACK', 'standard')|raw }}</span></a>
    </div>

    <div class="search_form">
        {{ Form_openForm('lang_filters', 'index.php?r=adm/lang/list', false, false, '','','row') }}
        <div class="lang-filter col-xs-12 col-sm-2">
            <label for="lang_code">{{ translate('_LANGUAGE', 'admin_lang') }}</label>:
            {{ Form_getInputDropdown("search_d", "lang_code", "lang_code", language_list, selected_language, ' onchange="DataTable_lang_table.reload();"') }}
        </div>
        <div class="lang-confr-filter  col-xs-12 col-sm-3">
            <label for="lang_code_diff">{{ translate('_LANG_COMPARE', 'admin_lang') }}</label>:
            {{ Form_getInputDropdown("search_d", "lang_code_diff", "lang_code_diff", language_list, selected_language_diff, ' onchange="DataTable_lang_table.reload();"') }}
        </div>
        {{ Form_closeForm() }}
    </div>
</div>
<table class="table table-bordered display" style="width:100%" id="lang_table"></table>

<script type="text/javascript">
    var requestBuilder = function (oState, oSelf) {
        var sort, dir, startIndex, results;
        oState = oState || {
            pagination: null,
            sortedBy: null
        };

        startIndex = (oState.pagination) ? oState.pagination.recordOffset : 0;
        results = (oState.pagination) ? oState.pagination.rowsPerPage : null;
        sort = (oState.sortedBy) ? oState.sortedBy.key : oSelf.getColumnSet().keys[0].getKey();
        dir = (oState.sortedBy && oState.sortedBy.dir === YAHOO.widget.DataTable.CLASS_DESC) ? "desc" : "asc";

        return "&results=" + results +
            "&startIndex=" + startIndex +
            "&sort=" + sort +
            "&dir=" + dir +
            "&la_module=" + YAHOO.util.Dom.get('la_module').value +
            "&la_text=" + YAHOO.util.Dom.get('la_text').value +
            "&lang_code=" + YAHOO.util.Dom.get('lang_code').value +
            "&lang_code_diff=" + YAHOO.util.Dom.get('lang_code_diff').value +
            "&only_empty=" + YAHOO.util.Dom.get('only_empty').checked +
            "&plugin_id=" + YAHOO.util.Dom.get('plugin_id').value;
    }

    var saveTranslation = function (callback, newData) {
        var new_value = newData;
        var old_value = this.value;
        var datatable = this.getDataTable();
        var id_text = this.getRecord().getData("id");
        var id_translation = this.getRecord().getData("id_translation");

        var myCallback = {
            success: function (o) {
                var r = YAHOO.lang.JSON.parse(o.responseText);
                if (r.success) {
                    callback(true, stripSlashes(r.new_value));
                } else {
                    callback(true, stripSlashes(r.old_value));
                }
            },
            failure: {}
        }

        var post = "id_text=" + encodeURIComponent(id_text) +
            "&lang_code=" + encodeURIComponent(YAHOO.util.Dom.get('lang_code').value) +
            "&new_value=" + encodeURIComponent(new_value) +
            "&old_value=" + encodeURIComponent(old_value);

        var url = "ajax.adm_server.php?r=adm/lang/saveData&";

        YAHOO.util.Connect.asyncRequest("POST", url, myCallback, post);
    }
    var saveComparisonTranslation = function (callback, newData) {
        var new_value = newData;
        var old_value = this.value;
        var datatable = this.getDataTable();
        var id_text = this.getRecord().getData("id");
        var id_translation = this.getRecord().getData("id_translation");

        var myCallback = {
            success: function (o) {
                var r = YAHOO.lang.JSON.parse(o.responseText);
                if (r.success) {
                    callback(true, stripSlashes(r.new_value));
                } else {
                    callback(true, stripSlashes(r.old_value));
                }
            },
            failure: {}
        }

        var post = "id_text=" + encodeURIComponent(id_text) +
            "&lang_code=" + encodeURIComponent(YAHOO.util.Dom.get('lang_code_diff').value) +
            "&new_value=" + encodeURIComponent(new_value) +
            "&old_value=" + encodeURIComponent(old_value);

        var url = "ajax.adm_server.php?r=adm/lang/saveData&";

        YAHOO.util.Connect.asyncRequest("POST", url, myCallback, post);
    }
    var TranslationFormatter = function (elLiner, oRecord, oColumn, oData) {
        var searched = YAHOO.util.Dom.get('la_text').value;
        if (searched) {
            var regexp = new RegExp(searched, 'gi');
            var string_to_replace = regexp.exec(oData)
            elLiner.innerHTML = oData.replace(regexp, '<span class="highlight">' + string_to_replace + '</span>');

        } else elLiner.innerHTML = oData;
    }
    YAHOO.util.Event.addListener("lang_filters", "submit", function (e) {
        YAHOO.util.Event.preventDefault(e);
        DataTable_lang_table.reload();
    });
    YAHOO.util.Event.addListener("filter_reset", "click", function (e) {
        YAHOO.util.Event.preventDefault(e);
        YAHOO.util.Dom.get('la_module').value = '0';
        YAHOO.util.Dom.get('la_text').value = '';
        DataTable_lang_table.reload();
    });

    var body = {{ data | json_encode(constant('JSON_HEX_APOS')) | raw }};
    var rows = [];

    body.forEach(function (item, k) {
        link = '<a id="' + item.id + '" href="' + item.delete + '" class="ico-sprite subs_del" title="{{ translate("_DEL", "admin_lang") }}"><span></span></a>'
        item.delete = link;
        rows.push(Object.assign({}, item));
    });

    var columns = [{
        data: 'text_module',
        title: "{{ translate('_LANG_MODULE ', 'admin_lang ') }}",
        sortable: true
    },
        {
            data: 'text_key',
            title: "{{ translate('_LANG_KEY ', 'admin_lang ') }}",
            sortable: true
        },
        {
            data: 'plugin_name',
            title: "{{ translate('_PLUGIN_NAME ', 'admin_lang ') }}",
            sortable: false
        },
        {
            data: 'translation_text',
            title: "{{ translate('_LANG_TRANSLATION ', 'admin_lang ') }}",
            sortable: true,
            edit: {
                type: 'text',
            },
        },
        {
            data: 'translation_text_diff',
            title: "{{ translate('_LANG_COMPARE ', 'admin_lang ') }}",
            sortable: true
        },
        {
            data: 'save_date',
            title: "{{ translate('_DATE ', 'admin_lang ') }}",
            sortable: true
        },
        {
            data: 'delete',
            title: "{{ translate('_DEL ', 'standard ') }}",
            sortable: false
        }
    ];

    $(function () {
        DataTable_lang_table = $('#lang_table').FormaTable({
            rowId: "id",
            scrollX: true,
            processing: true,
            serverSide: true,
            'ajax': {
                type: 'GET',
                data: function(d) {
                    d.lang_code = $("#lang_code").val();
                    d.lang_code_diff = $("#lang_code_diff").val();
                },
                url: 'ajax.adm_server.php?r=adm/lang/get',
            },
            paging: true,
            searching: true,
            columns,
            dom: 'Bfrtip',
            stateSave: true,
            deferRender: true,
            edit: {
                url: "ajax.adm_server.php?r=adm/lang/inline_edit",
                type: "POST",
                data: {
                    language: $("#lang_code").val(),
                },
                id: 'id_text'
            },
        });
    });
</script>
</div>