{% if use_label %}
<div class="container-back">
	<a href="index.php?r=elearning/show&id_common_label=-2">
		<span>&lsaquo;&lsaquo; {{ translate('_BACK_TO_LABEL', 'course') }}</span>
	</a>
</div>
{% endif %}
{% if courselist is empty %}
	<p>{{ translate('_NO_CONTENT', 'standard') }}</p>
{% endif %}
{% for course in courselist %}

	<div class="dash-course {% if course['user_status'] < 1 %}status_subscribed{% else %}status_begin{% endif %}">
		{% if course['use_logo_in_courselist'] and course['img_course'] %}
			<div class="logo_container">
				<img class="clogo"
					src="{{ path_course}}{{ course['img_course']}}"
					alt="{{ evalPhp('Util::purge', [course['name']])}}" />
			</div>
		{% endif %}
		{% if course['use_logo_in_courselist'] and not course['img_course'] %}
			<div class="logo_container">
				<img class="clogo cnologo"
					 src="{{ evalPhp('Get::tmpl_path') }}images/course/course_nologo.png"
					alt="{{ evalPhp('Util::purge', [course['name']]) }}" />
			</div>
		{% endif %}

		<div class="info_container">
		<h2>
			{% if course['can_enter']['can'] %}
				<a title="{{ evalPhp('Util::purge', [course['name']]) }}" href="index.php?modname=course&amp;op=aula&amp;idCourse={{ course['idCourse'] }}" {% if course['direct_play'] == 1 and course['level'] <= 3 and course['first_lo_type'] == 'scormorg' %}rel="lightbox"{% endif %}>
					{% if course['lang_code'] != 'none' %}
						{{ evalPhp('Get::img', ['language/'~course['lang_code']|lower~'.png', course['lang_code']]) }}
					{% endif %}
					{% if keyword != "" %}
						{{ evalPhp('Layout::highlight',[course['name'], keyword]) }}
					{% else %}
						{{ course['name'] }}
					{% endif %}
				</a>
			{% else %}
				{{ evalPhp('Get::img', ['standard/locked.png', translate('_'~course['can_enter']['reason']|lower, 'standard')]) }}
				{% if keyword != "" %}
					{{ evalPhp('Layout::highlight',[course['name'], keyword]) }}
				{% else %}
					{{ course['name'] }}
				{% endif %}
			{% endif %}
		</h2>
		<p class="course_support_info">
			{{ translate('_NO_CONTENT', 'standard')|raw }}
			{{ translate(ustatus[course['user_status']], 'course')|raw }}
			{{ translate('_USER_LVL', 'course', {'[level]': '<b>'~levels[course['level']]~'</b>'})|raw }}
		</p>
		{#<?php #}
			{#$acl_man = Docebo::user()->getAclManager();#}
			{#$levels = CourseLevel::getLevels();#}
			{##}
			{#while(list($num_lv, $name_level) = each($levels)) {#}
				{#if(CourseLevel::isTeacher($num_lv)) {#}
					{##}
				{#}#}
				{#if($course['level_show_user'] & (1 << $num_lv)) {#}
					{#if(CourseLevel::isTeacher($num_lv)) {#}
						{#echo "&nbsp;" . $name_level . ":&nbsp;";#}
						{#$users =& $acl_man->getUsers( Man_Course::getIdUserOfLevel($course['idCourse'], $num_lv, $course['course_edition']) );#}
						{#if(!empty($users)) {#}
							{#$first = true;#}
							{#while(list($id_user, $user_info) = each($users)) {#}
								{#if($first) $first = false;#}
								{#else echo(', ');#}
{#//								echo '<a href="index.php?modname=course&amp;op=viewprofile&amp;id_user='.$id_user.'">' . $acl_man->getConvertedUserName($user_info) . '</a>';#}
								{#echo '<b>'.$acl_man->getConvertedUserName($user_info).'</b>';#}
							{#} // end while#}
						{#} // end if#}
					{#}#}
				{#} // end if#}
			{#} // end while#}
		{#?>#}
		{#<p class="course_support_info">#}
			{#<?php#}
			{#echo Lang::t('_COURSE_INTRO', 'course', array(#}
				{#'[course_type]'		=> $course['course_type'],#}
				{#'[create_date]'		=> $course['create_date'],#}
				{#'[enrolled]'		=> $course['enrolled'],#}
				{#'[course_status]'	=> Lang::t($this->cstatus[$course['course_status']], 'course')#}
			{#));#}
			{#?>#}
		{#</p>#}
		{#<?php if(!empty($access['expiring_in']) && $access['expiring_in'] < 30) : ?>#}
			{#<p class="course_support_info">#}
				{#<?php echo Lang::t('_EXPIRING_IN', 'course', array('[expiring_in]' => $access['expiring_in'])); ?>#}
			{#</p>#}
		{#<?php endif; ?>#}
         {#<?php #}
         {#if((!empty($course['can_enter']['expiring_in']) && $course['can_enter']['can']==false && $course['can_enter']['expiring_in'] <= 0) || ($course['can_enter']['expiring_in'] == 0 && $course['can_enter']['can']==false)) : ?>#}
            {#<p class="course_support_info">#}
                {#<?php echo Lang::t('_EXPIRED', 'course'); ?>#}
            {#</p>#}
        {#<?php endif; ?>    				#}
		{#<p class="course_support_info">#}
			{#<?php if($course['code']) { ?><i style="font-size:.88em">[<?php echo $keyword != "" ? Layout::highlight($course['code'], $keyword) : $course['code']; ?>]</i><?php } ?>#}
		{#</p>#}
		{#<?php#}
			{#$smodel = new SubscriptionAlms();#}
			{#if ($smodel->isUserWaitingForSelfUnsubscribe(Docebo::user()->idst, $course['idCourse'])) {#}
				{#echo '<p style="padding:.4em">'.Lang::t('_UNSUBSCRIBE_REQUEST_WAITING_FOR_MODERATION', 'course').'</p>';#}
			{#} else {#}

				{#//auto unsubscribe management: create a link for the user in the course block#}
				{#$_can_unsubscribe = ($course['auto_unsubscribe']==1 || $course['auto_unsubscribe']==2);#}
				{#$_date_limit = $course['unsubscribe_date_limit'] != "" && $course['unsubscribe_date_limit'] != "0000-00-00 00:00:00"#}
					{#? $course['unsubscribe_date_limit']#}
					{#: FALSE;#}
				{#if ($_can_unsubscribe):#}
		{#?>#}
		{#<p class="course_support_info">#}
			{#<?php if ($_date_limit !== FALSE && $_date_limit < date("Y-m-d H:i:s")) {#}
				{#echo '';#}
			{#} else { ?>#}
			{#<a href="index.php?r=elearning/self_unsubscribe&amp;id_course=<?php echo $course['idCourse']; ?>&amp;back=<?php echo Get::req('r', DOTY_STRING, ""); ?>"#}
				 {#title="<?php echo Lang::t('_SELF_UNSUBSCRIBE', 'course'); ?>">#}
				 {#<?php echo Lang::t('_SELF_UNSUBSCRIBE', 'course'); ?>#}
			{#</a>#}
			{#<?php#}
				{#if ($_date_limit) echo '&nbsp;('.Lang::t('_UNTIL', 'standard').' '.Format::date(substr($_date_limit, 0, 10), 'date').')';#}
			{#?>#}
			{#<?php } //endif ?>#}
		{#</p>#}
		{#<?php#}
				{#endif;#}
			{#}#}
			{#unset($smodel);#}
		{#?>#}
		</div><!-- info container -->
	</div>

{% endfor %}